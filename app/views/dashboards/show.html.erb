<div class="container mt-5">
  <!-- Profile Section -->
  <div class="row">
    <div class="col-md-4 mb-4">
      <div class="card text-center">
        <%= image_tag current_user.avatar.attached? ? current_user.avatar : "default_avatar.png", class: "rounded-circle img-fluid" %>
        <div class="card-body">
          <h2 class="card-title"><%= current_user.profile.name %></h2>
          <p class="card-text"><%= current_user.profile.bio %></p>
          <div class="profile-details mt-4">
            <p><strong>Phone:</strong> <%= current_user.profile.phone_number %></p>
            <p><strong>Age:</strong> <%= current_user.profile.age %></p>
            <p><strong>Price:</strong> <%= number_to_currency(current_user.profile.price) %></p>
            <p><strong>Roles:</strong> <%= current_user.profile.roles %></p>
            <p><strong>Listed:</strong> <%= @profile.is_listed ? 'Yes' : 'No' %></p>
          </div>
          <div class="profile-actions mt-4">
            <%= link_to "List My Profile", toggle_list_profile_path(@profile), method: :patch, data: { turbo_method: :patch ,turbo_confirm: "Are you sure you want to change your profile listing?" }, class: "btn btn-custom list-my-profile" %>
            <%= link_to "Edit Profile", edit_profile_path(@profile), class: "btn btn-custom edit-profile" %>
            <%= link_to "Delete Profile", profile_path(@profile), method: :delete, data: { turbo_method: :delete, turbo_confirm: "Are you sure?" }, class: "btn btn-custom delete-profile"  %>
          </div>
        </div>
      </div>
    </div>

  <div class="row">
    <div class="col-md-8">
      <div class="bookings-section mb-4">
        <h3>My Bookings</h3>
        <% @bookings.each do |booking| %>
          <div class="card mb-3">
            <div class="card-body d-flex align-items-center">
              <%= image_tag booking.profile.user.avatar.attached? ? booking.profile.user.avatar : "default_avatar.png", class: "rounded-circle booking-avatar mr-3", style: "width: 85px; height: 85px;" %>
              <div class="flex-grow-1">
                <h5 class="card-title mb-0">Booking with <%= booking.profile.name %></h5>
                <p class="card-text mb-0">From: <%= booking.start_time.strftime("%A, %b %d %Y, %I:%M %p") %> to <%= booking.end_time.strftime("%I:%M %p") %></p>
                <p class="card-text mb-0"><%= booking.notes %></p>
              </div>
              <div>
                <!-- Cancel button for my bookings if they are accepted -->
                <% if booking.accepted? %>
                  <%= link_to 'cancel Booking', cancel_booking_form_path(profile_id: @profile.id, id: booking.id), class: 'btn btn-primary' %>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
        <% if @bookings.empty? %>
          <p>You have no bookings.</p>
        <% end %>
      </div>

      <!-- Incoming Bookings Section -->
      <div class="incoming-bookings-section mb-4">
        <h3>Incoming Bookings</h3>
        <% @incoming_bookings.each do |booking| %>
          <div class="card mb-3">
            <div class="card-body d-flex align-items-center">
              <%= image_tag booking.user.avatar.attached? ? booking.user.avatar : "default_avatar.png", class: "rounded-circle booking-avatar mr-3", style: "width: 85px; height: 85px;" %>
              <div class="flex-grow-1">
                <h5 class="card-title mb-0">Booking from <%= booking.user.email %></h5>
                <p class="card-text mb-0">From: <%= booking.start_time.strftime("%A, %b %d %Y, %I:%M %p") %> to <%= booking.end_time.strftime("%I:%M %p") %></p>
                <p class="card-text mb-0"><%= booking.notes %></p>
              </div>
              <div>
                <!-- Accept and Reject buttons for incoming bookings -->
                <%= link_to 'Accept Booking', accept_booking_form_path(profile_id: @profile.id, id: booking.id), class: 'btn btn-primary' %>
                <%= link_to 'Reject Booking', reject_booking_form_path(profile_id: @profile.id, id: booking.id), class: 'btn btn-primary' %>
              </div>
            </div>
          </div>
        <% end %>
        <% if @incoming_bookings.empty? %>
          <p>No incoming bookings.</p>
        <% end %>
      </div>
    </div>
  </div>
</div>
